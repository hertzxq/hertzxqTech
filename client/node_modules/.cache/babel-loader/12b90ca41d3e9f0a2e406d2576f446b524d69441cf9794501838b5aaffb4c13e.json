{"ast":null,"code":"import React,{useEffect,useState}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import Header from\"../main/header\";import Footer from\"../main/footer\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function Profile(){const[profileData,setProfileData]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const navigate=useNavigate();useEffect(()=>{const fetchProfile=async()=>{const token=localStorage.getItem('token');if(!token){navigate('/login');return;}try{const response=await axios.get('http://localhost:5000/profile',{headers:{'Authorization':\"Bearer \".concat(token)}});console.log('Profile data:',response.data);// Сохраняем информацию о пользователе в localStorage\nlocalStorage.setItem('user',JSON.stringify(response.data));setProfileData(response.data);}catch(error){console.error('Profile fetch error:',error);setError('Ошибка при загрузке профиля. Пожалуйста, войдите снова.');localStorage.removeItem('token');navigate('/login');}finally{setLoading(false);}};fetchProfile();},[navigate]);if(loading){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}if(error){return/*#__PURE__*/_jsx(\"div\",{children:error});}const handleLogout=()=>{// Удаляем токен и информацию о пользователе из localStorage\nlocalStorage.removeItem('token');localStorage.removeItem('user');navigate('/');};const formatDate=dateString=>{const options={year:'numeric',month:'long',day:'numeric',hour:'numeric',minute:'numeric'};return new Date(dateString).toLocaleDateString('ru-RU',options);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsxs(\"main\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"profile-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"profile-content\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u041F\\u0440\\u043E\\u0444\\u0438\\u043B\\u044C \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile-details\",children:[/*#__PURE__*/_jsx(\"img\",{src:require('../img/profile_avatar.jpg'),alt:\"User Avatar\",className:\"profile-avatar\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-info\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0418\\u043C\\u044F \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F: \",profileData.username]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Email: \",profileData.email]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn_leave\",onClick:handleLogout,children:\"\\u0412\\u044B\\u0439\\u0442\\u0438\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"order-history-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"order-history-title\",children:\"\\u0418\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F \\u0437\\u0430\\u043A\\u0430\\u0437\\u043E\\u0432\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"order-history-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"\\u041D\\u043E\\u043C\\u0435\\u0440\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0414\\u0430\\u0442\\u0430\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0421\\u0442\\u043E\\u0438\\u043C\\u043E\\u0441\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:profileData.orders&&profileData.orders.map((order,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"table-profile\",children:[/*#__PURE__*/_jsx(\"td\",{children:order.id}),/*#__PURE__*/_jsx(\"td\",{children:formatDate(order.created_at)}),/*#__PURE__*/_jsx(\"td\",{children:order.items.map(item=>item.title).join(', ')}),/*#__PURE__*/_jsxs(\"td\",{className:\"table-price\",children:[order.price,\" \\u0440\\u0443\\u0431.\"]}),/*#__PURE__*/_jsx(\"td\",{className:\"table-success\",children:order.status})]},index))})]})]})]}),/*#__PURE__*/_jsx(Footer,{})]});};","map":{"version":3,"names":["React","useEffect","useState","axios","useNavigate","Header","Footer","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Profile","profileData","setProfileData","loading","setLoading","error","setError","navigate","fetchProfile","token","localStorage","getItem","response","get","headers","concat","console","log","data","setItem","JSON","stringify","removeItem","children","handleLogout","formatDate","dateString","options","year","month","day","hour","minute","Date","toLocaleDateString","className","src","require","alt","username","email","onClick","orders","map","order","index","id","created_at","items","item","title","join","price","status"],"sources":["C:/Users/bomsh/Documents/hertzxqTech/client/src/components/profile/profile.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport Header from \"../main/header\";\r\nimport Footer from \"../main/footer\";\r\n\r\nexport default function Profile() {\r\n    const [profileData, setProfileData] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        const fetchProfile = async () => {\r\n            const token = localStorage.getItem('token');\r\n            if (!token) {\r\n                navigate('/login');\r\n                return;\r\n            }\r\n\r\n            try {\r\n                const response = await axios.get('http://localhost:5000/profile', {\r\n                    headers: {\r\n                        'Authorization': `Bearer ${token}`\r\n                    }\r\n                });\r\n                console.log('Profile data:', response.data);\r\n\r\n                // Сохраняем информацию о пользователе в localStorage\r\n                localStorage.setItem('user', JSON.stringify(response.data));\r\n\r\n                setProfileData(response.data);\r\n            } catch (error) {\r\n                console.error('Profile fetch error:', error);\r\n                setError('Ошибка при загрузке профиля. Пожалуйста, войдите снова.');\r\n                localStorage.removeItem('token');\r\n                navigate('/login');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchProfile();\r\n    }, [navigate]);\r\n\r\n    if (loading) {\r\n        return <div>Loading...</div>;\r\n    }\r\n\r\n    if (error) {\r\n        return <div>{error}</div>;\r\n    }\r\n\r\n    const handleLogout = () => {\r\n        // Удаляем токен и информацию о пользователе из localStorage\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('user');\r\n        navigate('/');\r\n    };\r\n\r\n    const formatDate = (dateString) => {\r\n        const options = { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric' };\r\n        return new Date(dateString).toLocaleDateString('ru-RU', options);\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <Header />\r\n            <main>\r\n                <div className=\"profile-section\">\r\n                    <div className=\"profile-content\">\r\n                        <h1>Профиль пользователя</h1>\r\n                        <div className=\"profile-details\">\r\n                            <img src={require('../img/profile_avatar.jpg')} alt=\"User Avatar\" className=\"profile-avatar\" />\r\n                            <div className=\"user-info\">\r\n                                <p>Имя пользователя: {profileData.username}</p>\r\n                                <p>Email: {profileData.email}</p>\r\n                            </div>\r\n                            <button className='btn_leave' onClick={handleLogout}>Выйти</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"order-history-container\">\r\n                    <h1 className=\"order-history-title\">История заказов</h1>\r\n                    <table className=\"order-history-table\">\r\n                        <thead>\r\n                            <tr>\r\n                                <th>Номер</th>\r\n                                <th>Дата</th>\r\n                                <th>Название</th>\r\n                                <th>Стоимость</th>\r\n                                <th>Статус</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {profileData.orders && profileData.orders.map((order, index) => (\r\n                                <tr key={index} className='table-profile'>\r\n                                    <td>{order.id}</td>\r\n                                    <td>{formatDate(order.created_at)}</td>\r\n                                    <td>{order.items.map(item => item.title).join(', ')}</td>\r\n                                    <td className='table-price'>{order.price} руб.</td>\r\n                                    <td className='table-success'>{order.status}</td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </main>\r\n            <Footer />\r\n        </>\r\n    );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}